openapi: 3.0.3
info:
  title: Email Helper API
  description: REST API for Email Helper application with AI-powered email classification and task management
  version: 1.0.0
  contact:
    name: Email Helper
    
servers:
  - url: http://localhost:8000
    description: Local development server

tags:
  - name: Health
    description: Health check and status endpoints
  - name: AI
    description: AI-powered email processing
  - name: Emails
    description: Email management and operations
  - name: Tasks
    description: Task management
  - name: Settings
    description: User settings
  - name: Processing
    description: Background processing pipelines

paths:
  /health:
    get:
      summary: Health check
      tags: [Health]
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  service:
                    type: string
                    example: email-helper-api
                  version:
                    type: string
                    example: "1.0.0"
                  database:
                    type: string
                    example: healthy

  /:
    get:
      summary: API root information
      tags: [Health]
      responses:
        '200':
          description: API information
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  version:
                    type: string
                  docs:
                    type: string
                  health:
                    type: string

  /api/ai/classification:
    post:
      summary: Classify single email content (new consistent naming)
      description: |
        Atomic operation for classifying a single email. Uses singular naming for single-item operations.
        Replaces the deprecated `/api/ai/classify` endpoint.
      tags: [AI]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - subject
                - sender
                - content
              properties:
                subject:
                  type: string
                  example: "Team meeting tomorrow"
                sender:
                  type: string
                  example: "manager@company.com"
                content:
                  type: string
                  example: "Please join us for the team meeting tomorrow at 2 PM"
                context:
                  type: string
                  example: ""
      responses:
        '200':
          description: Classification result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmailClassificationResponse'
        '400':
          description: Invalid request
        '500':
          description: AI processing failed

  /api/ai/classifications:
    post:
      summary: Batch classify multiple emails (non-streaming)
      description: |
        Batch operation for classifying multiple emails. Returns all results at once in a structured response.
        Uses plural naming for batch operations.
      tags: [AI]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email_ids
              properties:
                email_ids:
                  type: array
                  items:
                    type: string
                  example: ["email-1", "email-2", "email-3"]
                context:
                  type: string
                  example: ""
      responses:
        '200':
          description: Batch classification results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchClassificationResponse'
        '400':
          description: Invalid request (empty email_ids)

  /api/ai/classifications/stream:
    post:
      summary: Batch classify multiple emails with Server-Sent Events (SSE) streaming
      description: |
        Batch operation with real-time progress updates via Server-Sent Events.
        Use this for UI progress indicators during long-running classification jobs.
      tags: [AI]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email_ids
              properties:
                email_ids:
                  type: array
                  items:
                    type: string
                  example: ["email-1", "email-2", "email-3"]
                context:
                  type: string
      responses:
        '200':
          description: SSE stream of classification events
          content:
            text/event-stream:
              schema:
                type: object
                properties:
                  current:
                    type: integer
                  total:
                    type: integer
                  status:
                    type: string
                    enum: [processing, completed, error]
                  email_id:
                    type: string
                  category:
                    type: string
                  message:
                    type: string
                  error:
                    type: string
                  progress:
                    type: number
                    format: float
                    minimum: 0
                    maximum: 100
        '400':
          description: Invalid request

  /api/ai/summary:
    post:
      summary: Generate single email summary (new consistent naming)
      description: |
        Atomic operation for summarizing a single email. Uses singular naming for single-item operations.
        Replaces the deprecated `/api/ai/summarize` endpoint.
      tags: [AI]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email_content
              properties:
                email_content:
                  type: string
                summary_type:
                  type: string
                  enum: [brief, detailed]
                  default: brief
      responses:
        '200':
          description: Summary generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SummaryResponse'
        '400':
          description: Invalid request
        '500':
          description: AI processing failed

  /api/ai/summaries:
    post:
      summary: Batch summarize multiple emails
      description: |
        Batch operation for summarizing multiple emails. Returns all summaries at once.
        Uses plural naming for batch operations.
      tags: [AI]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email_ids
              properties:
                email_ids:
                  type: array
                  items:
                    type: string
                  example: ["email-1", "email-2", "email-3"]
                summary_type:
                  type: string
                  enum: [brief, detailed, key_points]
                  default: brief
      responses:
        '200':
          description: Batch summary results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchSummaryResponse'
        '400':
          description: Invalid request (empty email_ids)

  /api/ai/classify:
    post:
      summary: Classify email content (DEPRECATED)
      deprecated: true
      description: |
        **DEPRECATED**: This endpoint is deprecated and will be removed on 2025-05-01.
        Use `POST /api/ai/classification` instead for consistent singular naming.
        
        This endpoint now returns deprecation headers:
        - `X-Deprecation-Warning`: Migration notice
        - `X-Sunset`: Removal date
      tags: [AI]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - subject
                - sender
                - content
              properties:
                subject:
                  type: string
                  example: "Team meeting tomorrow"
                sender:
                  type: string
                  example: "manager@company.com"
                content:
                  type: string
                  example: "Please join us for the team meeting tomorrow at 2 PM"
                context:
                  type: string
                  example: ""
      responses:
        '200':
          description: Classification result
          headers:
            X-Deprecation-Warning:
              schema:
                type: string
              description: "This endpoint is deprecated. Use POST /api/ai/classification instead"
            X-Sunset:
              schema:
                type: string
              description: "2025-05-01"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmailClassificationResponse'
        '500':
          description: AI processing failed

  /api/ai/summarize:
    post:
      summary: Generate email summary (DEPRECATED)
      deprecated: true
      description: |
        **DEPRECATED**: This endpoint is deprecated and will be removed on 2025-05-01.
        Use `POST /api/ai/summary` instead for consistent singular naming.
        
        This endpoint now returns deprecation headers:
        - `X-Deprecation-Warning`: Migration notice
        - `X-Sunset`: Removal date
      tags: [AI]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email_content
              properties:
                email_content:
                  type: string
                summary_type:
                  type: string
                  enum: [brief, detailed]
                  default: brief
      responses:
        '200':
          description: Summary generated
          headers:
            X-Deprecation-Warning:
              schema:
                type: string
              description: "This endpoint is deprecated. Use POST /api/ai/summary instead"
            X-Sunset:
              schema:
                type: string
              description: "2025-05-01"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SummaryResponse'

  /api/ai/classify-batch-stream:
    post:
      summary: Batch classify with SSE streaming (DEPRECATED)
      deprecated: true
      description: |
        **DEPRECATED**: This endpoint is deprecated and will be removed on 2025-05-01.
        Use `POST /api/ai/classifications/stream` instead for consistent naming.
      tags: [AI]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email_ids
              properties:
                email_ids:
                  type: array
                  items:
                    type: string
                context:
                  type: string
      responses:
        '200':
          description: SSE stream of classification events
          headers:
            X-Deprecation-Warning:
              schema:
                type: string
              description: "This endpoint is deprecated. Use POST /api/ai/classifications/stream instead"
            X-Sunset:
              schema:
                type: string
              description: "2025-05-01"
          content:
            text/event-stream:
              schema:
                type: object
          
  /api/ai/action-items:
    post:
      summary: Extract action items from email
      tags: [AI]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email_content
              properties:
                email_content:
                  type: string
                context:
                  type: string
      responses:
        '200':
          description: Action items extracted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActionItemResponse'

  /api/ai/summarize:
    post:
      summary: Generate email summary
      tags: [AI]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email_content
              properties:
                email_content:
                  type: string
                summary_type:
                  type: string
                  enum: [brief, detailed]
                  default: brief
      responses:
        '200':
          description: Summary generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SummaryResponse'

  /api/ai/templates:
    get:
      summary: Get available prompt templates
      tags: [AI]
      responses:
        '200':
          description: List of available templates
          content:
            application/json:
              schema:
                type: object
                properties:
                  templates:
                    type: array
                    items:
                      type: string
                  descriptions:
                    type: object
                    additionalProperties:
                      type: string

  /api/ai/health:
    get:
      summary: Check AI service health
      tags: [AI]
      responses:
        '200':
          description: AI service is healthy
        '503':
          description: AI service unavailable

  /api/emails:
    get:
      summary: Get paginated list of emails
      description: |
        Retrieves emails intelligently based on query parameters. The backend automatically selects
        the appropriate data source:
        
        - **With category parameter**: Returns classified emails from database (SQLite cache)
        - **With folder parameter**: Returns live emails from Outlook via COM interface
        - **Default (no parameters)**: Returns emails from Outlook Inbox
        
        This unified endpoint provides a clean abstraction over the backend data sources,
        allowing the frontend to request emails by their semantic meaning rather than
        implementation details.
        
        **Data Sources:**
        - Live Outlook (via COM): Fresh data, current folder locations
        - SQLite database: Cached data with AI classifications and summaries
        
        **Use cases:**
        - Browse current inbox: `/api/emails` or `/api/emails?folder=Inbox`
        - View sent emails: `/api/emails?folder=Sent`
        - Filter by AI category: `/api/emails?category=fyi`
        - View action items: `/api/emails?category=action_required`
      tags: [Emails]
      parameters:
        - name: folder
          in: query
          description: Outlook folder name (uses Outlook data source)
          schema:
            type: string
            default: Inbox
          example: Inbox
        - name: limit
          in: query
          description: Maximum number of emails to return
          schema:
            type: integer
            minimum: 1
            maximum: 50000
            default: 50
          example: 50
        - name: offset
          in: query
          description: Number of emails to skip for pagination
          schema:
            type: integer
            minimum: 0
            default: 0
          example: 0
        - name: category
          in: query
          description: AI classification category (uses database data source)
          schema:
            type: string
            enum: [fyi, action_required, newsletter, calendar_event, auto_response, receipts_confirmations, other]
          example: fyi
      responses:
        '200':
          description: List of emails
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmailListResponse'
        '500':
          description: Failed to retrieve emails
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/emails/{id}:
    get:
      summary: Get specific email by ID
      tags: [Emails]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Email details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Email'
        '404':
          description: Email not found

  /api/emails/search:
    get:
      summary: Search emails
      tags: [Emails]
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: per_page
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmailListResponse'

  /api/emails/stats:
    get:
      summary: Get email statistics
      tags: [Emails]
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 10
            maximum: 1000
            default: 100
      responses:
        '200':
          description: Email statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_emails:
                    type: integer
                  unread_emails:
                    type: integer
                  emails_by_folder:
                    type: object
                    additionalProperties:
                      type: integer
                  emails_by_sender:
                    type: object
                    additionalProperties:
                      type: integer

  /api/emails/prefetch:
    post:
      summary: Prefetch multiple emails
      tags: [Emails]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
      responses:
        '200':
          description: Prefetch results
          content:
            application/json:
              schema:
                type: object
                properties:
                  emails:
                    type: array
                    items:
                      $ref: '#/components/schemas/Email'
                  success_count:
                    type: integer
                  error_count:
                    type: integer
                  errors:
                    type: array
                    items:
                      type: string

  /api/emails/{id}/read:
    put:
      summary: Update email read status
      tags: [Emails]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: read
          in: query
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Status updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmailOperationResponse'

  /api/emails/{id}/move:
    post:
      summary: Move email to folder
      tags: [Emails]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: destination_folder
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Email moved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmailOperationResponse'

  /api/emails/{id}/classification:
    put:
      summary: Update email classification
      tags: [Emails]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - category
              properties:
                category:
                  type: string
                apply_to_outlook:
                  type: boolean
                  default: false
      responses:
        '200':
          description: Classification updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmailOperationResponse'

  /api/emails/classifications/apply:
    post:
      summary: Apply classifications to multiple emails
      description: |
        New plural-named endpoint for applying classifications to multiple emails in Outlook.
        Replaces /api/emails/bulk-apply-to-outlook with consistent REST naming.
      tags: [Emails]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email_ids
              properties:
                email_ids:
                  type: array
                  items:
                    type: string
                apply_to_outlook:
                  type: boolean
                  default: true
      responses:
        '200':
          description: Classification apply results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchOperationResponse'

  /api/emails/bulk-apply-to-outlook:
    post:
      summary: Bulk apply classifications to Outlook
      deprecated: true
      description: |
        **DEPRECATED**: Use POST /api/emails/classifications/apply instead.
        This endpoint is maintained for backward compatibility.
      tags: [Emails]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email_ids
              properties:
                email_ids:
                  type: array
                  items:
                    type: string
                apply_to_outlook:
                  type: boolean
                  default: true
      responses:
        '200':
          description: Bulk apply results
          headers:
            X-Deprecated:
              description: Indicates this endpoint is deprecated
              schema:
                type: boolean
            X-Deprecated-Message:
              description: Deprecation message with replacement endpoint
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchOperationResponse'

  /api/emails/batch-process:
    post:
      summary: Batch process emails with AI classification and action item extraction
      deprecated: true
      description: |
        **DEPRECATED**: Use POST /api/ai/classifications instead.
        This endpoint is maintained for backward compatibility.
        
        Processes multiple emails in batch, performing:
        - AI classification and categorization
        - Confidence scoring
        - Action item extraction (for actionable categories)
        - Priority calculation
        - Optional database persistence
      tags: [Emails]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email_ids
              properties:
                email_ids:
                  type: array
                  items:
                    type: string
                  description: List of email IDs to process
                save_to_database:
                  type: boolean
                  default: false
                  description: Whether to save processed results to database
      responses:
        '200':
          description: Batch processing results (returns 200 even with partial failures)
          headers:
            X-Deprecated:
              description: Indicates this endpoint is deprecated
              schema:
                type: boolean
            X-Deprecated-Message:
              description: Deprecation message with replacement endpoint
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchOperationResponse'
        '400':
          description: Invalid request (missing email_ids)

  /api/emails/extract-tasks:
    post:
      summary: Extract tasks from emails
      tags: [Emails]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email_ids
              properties:
                email_ids:
                  type: array
                  items:
                    type: string
                apply_to_outlook:
                  type: boolean
      responses:
        '200':
          description: Task extraction completed

  /api/emails/sync-to-database:
    post:
      summary: Sync classified emails to database
      tags: [Emails]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - emails
              properties:
                emails:
                  type: array
                  items:
                    $ref: '#/components/schemas/Email'
      responses:
        '200':
          description: Sync completed

  /api/emails/analyze-holistically:
    post:
      summary: Holistic email analysis across multiple emails
      description: |
        Performs AI-powered holistic analysis across multiple emails to identify:
        - Truly relevant actions that require attention
        - Superseded actions (resolved by newer emails)
        - Duplicate email groups
        - Expired items (past deadlines/events)
        
        This endpoint provides intelligent cross-email analysis for inbox management.
      tags: [Emails]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HolisticAnalysisRequest'
      responses:
        '200':
          description: Holistic analysis results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HolisticAnalysisResponse'
        '400':
          description: Invalid request (empty email_ids)
        '500':
          description: AI analysis failed

  /api/folders:
    get:
      summary: Get list of email folders
      tags: [Emails]
      responses:
        '200':
          description: List of folders
          content:
            application/json:
              schema:
                type: object
                properties:
                  folders:
                    type: array
                    items:
                      $ref: '#/components/schemas/EmailFolder'
                  total:
                    type: integer

  /api/conversations/{id}:
    get:
      summary: Get conversation thread
      tags: [Emails]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Conversation thread
          content:
            application/json:
              schema:
                type: object
                properties:
                  conversation_id:
                    type: string
                  emails:
                    type: array
                    items:
                      $ref: '#/components/schemas/Email'
                  total:
                    type: integer

  /api/tasks:
    get:
      summary: Get paginated list of tasks
      tags: [Tasks]
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: status
          in: query
          schema:
            type: string
        - name: priority
          in: query
          schema:
            type: string
        - name: search
          in: query
          schema:
            type: string
      responses:
        '200':
          description: List of tasks
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskListResponse'
    post:
      summary: Create new task
      tags: [Tasks]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaskCreate'
      responses:
        '201':
          description: Task created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
    delete:
      summary: Delete multiple tasks
      description: |
        New plural-named endpoint for deleting multiple tasks.
        Uses DELETE verb with request body (following REST best practices for bulk operations).
        Replaces POST /api/tasks/bulk-delete.
      tags: [Tasks]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - task_ids
              properties:
                task_ids:
                  type: array
                  items:
                    type: integer
                  description: List of task IDs to delete
      responses:
        '200':
          description: Delete results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchOperationResponse'
        '400':
          description: Invalid request
        '500':
          description: Delete failed

  /api/tasks/{id}:
    get:
      summary: Get task by ID
      tags: [Tasks]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Task details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '404':
          description: Task not found
    put:
      summary: Update task
      tags: [Tasks]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaskUpdate'
      responses:
        '200':
          description: Task updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
    delete:
      summary: Delete task
      tags: [Tasks]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Task deleted

  /api/tasks/stats:
    get:
      summary: Get task statistics
      tags: [Tasks]
      responses:
        '200':
          description: Task statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_tasks:
                    type: integer
                  pending_tasks:
                    type: integer
                  completed_tasks:
                    type: integer
                  overdue_tasks:
                    type: integer
                  tasks_by_priority:
                    type: object
                  tasks_by_category:
                    type: object

  /api/tasks/updates:
    post:
      summary: Update multiple tasks
      description: |
        New plural-named endpoint for updating multiple tasks with the same field values.
        Replaces /api/tasks/bulk-update with consistent REST naming.
      tags: [Tasks]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - task_ids
                - updates
              properties:
                task_ids:
                  type: array
                  items:
                    type: integer
                  description: List of task IDs to update
                updates:
                  $ref: '#/components/schemas/TaskUpdate'
      responses:
        '200':
          description: Update results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchOperationResponse'
        '400':
          description: Invalid request
        '500':
          description: Update failed

  /api/tasks/bulk-update:
    post:
      summary: Bulk update multiple tasks
      deprecated: true
      description: |
        **DEPRECATED**: Use POST /api/tasks/updates instead.
        This endpoint is maintained for backward compatibility.
      tags: [Tasks]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - task_ids
                - updates
              properties:
                task_ids:
                  type: array
                  items:
                    type: integer
                  description: List of task IDs to update
                updates:
                  $ref: '#/components/schemas/TaskUpdate'
      responses:
        '200':
          description: Bulk update results
          headers:
            X-Deprecated:
              description: Indicates this endpoint is deprecated
              schema:
                type: boolean
            X-Deprecated-Message:
              description: Deprecation message with replacement endpoint
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchOperationResponse'
        '400':
          description: Invalid request
        '500':
          description: Update failed

  /api/tasks/bulk-delete:
    post:
      summary: Bulk delete multiple tasks
      deprecated: true
      description: |
        **DEPRECATED**: Use DELETE /api/tasks (with body: {task_ids}) instead.
        This endpoint is maintained for backward compatibility.
        The new endpoint uses the proper DELETE HTTP verb for deletion operations.
      tags: [Tasks]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - task_ids
              properties:
                task_ids:
                  type: array
                  items:
                    type: integer
                  description: List of task IDs to delete
      responses:
        '200':
          description: Bulk delete results
          headers:
            X-Deprecated:
              description: Indicates this endpoint is deprecated
              schema:
                type: boolean
            X-Deprecated-Message:
              description: Deprecation message with replacement endpoint
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchOperationResponse'
        '400':
          description: Invalid request
        '500':
          description: Delete failed

  /api/settings:
    get:
      summary: Get user settings
      tags: [Settings]
      responses:
        '200':
          description: User settings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSettings'
    put:
      summary: Update user settings
      tags: [Settings]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserSettings'
      responses:
        '200':
          description: Settings updated
    delete:
      summary: Reset settings to defaults
      tags: [Settings]
      responses:
        '200':
          description: Settings reset

  /api/processing/start:
    post:
      summary: Start processing pipeline
      tags: [Processing]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email_ids
              properties:
                email_ids:
                  type: array
                  items:
                    type: string
                priority:
                  type: string
                  enum: [low, medium, high, urgent]
                  default: medium
      responses:
        '200':
          description: Pipeline started
          content:
            application/json:
              schema:
                type: object
                properties:
                  pipeline_id:
                    type: string
                  status:
                    type: string
                  email_count:
                    type: integer
                  message:
                    type: string

  /api/processing/{id}/status:
    get:
      summary: Get pipeline status
      tags: [Processing]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Pipeline status
        '404':
          description: Pipeline not found

components:
  schemas:
    Email:
      type: object
      properties:
        id:
          type: string
        subject:
          type: string
        sender:
          type: string
        recipient:
          type: string
        body:
          type: string
        content:
          type: string
        received_time:
          type: string
          format: date-time
        date:
          type: string
          format: date-time
        is_read:
          type: boolean
        has_attachments:
          type: boolean
        importance:
          type: string
          enum: [Low, Normal, High]
        categories:
          type: array
          items:
            type: string
        conversation_id:
          type: string
        conversation_count:
          type: integer
        ai_category:
          type: string
        ai_confidence:
          type: number
        ai_reasoning:
          type: string
        one_line_summary:
          type: string
        category:
          type: string

    EmailListResponse:
      type: object
      properties:
        emails:
          type: array
          items:
            $ref: '#/components/schemas/Email'
        total:
          type: integer
        offset:
          type: integer
        limit:
          type: integer
        has_more:
          type: boolean

    EmailOperationResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        email_id:
          type: string

    EmailFolder:
      type: object
      properties:
        name:
          type: string
        unread_count:
          type: integer
        total_count:
          type: integer
        folder_path:
          type: string

    EmailClassificationResponse:
      type: object
      properties:
        category:
          type: string
          enum:
            - required_personal_action
            - team_action
            - optional_event
            - fyi
            - newsletter
            - job_listing
            - spam_to_delete
            - work_relevant
        confidence:
          type: number
          minimum: 0
          maximum: 1
        reasoning:
          type: string
        alternative_categories:
          type: array
          items:
            type: string
        processing_time:
          type: number
        one_line_summary:
          type: string

    ActionItemResponse:
      type: object
      properties:
        action_items:
          type: array
          items:
            type: string
        urgency:
          type: string
        deadline:
          type: string
        confidence:
          type: number
        due_date:
          type: string
        action_required:
          type: boolean
        explanation:
          type: string
        relevance:
          type: string
        links:
          type: array
          items:
            type: string

    SummaryResponse:
      type: object
      properties:
        summary:
          type: string
        key_points:
          type: array
          items:
            type: string
        confidence:
          type: number
        processing_time:
          type: number

    BatchClassificationResponse:
      type: object
      description: Response from batch classification endpoint
      properties:
        total:
          type: integer
          description: Total number of emails in the batch
        successful:
          type: integer
          description: Number of successfully classified emails
        failed:
          type: integer
          description: Number of failed classifications
        results:
          type: array
          description: Classification result for each email
          items:
            $ref: '#/components/schemas/BatchClassificationResult'

    BatchClassificationResult:
      type: object
      description: Single email classification result in batch operation
      properties:
        email_id:
          type: string
          description: Email identifier
        success:
          type: boolean
          description: Whether classification succeeded
        classification:
          $ref: '#/components/schemas/EmailClassificationResponse'
          description: Classification details (present if success is true)
        error:
          type: string
          description: Error message (present if success is false)

    BatchSummaryResponse:
      type: object
      description: Response from batch summarization endpoint
      properties:
        total:
          type: integer
          description: Total number of emails in the batch
        successful:
          type: integer
          description: Number of successfully summarized emails
        failed:
          type: integer
          description: Number of failed summarizations
        results:
          type: array
          description: Summary result for each email
          items:
            $ref: '#/components/schemas/BatchSummaryResult'

    BatchSummaryResult:
      type: object
      description: Single email summary result in batch operation
      properties:
        email_id:
          type: string
          description: Email identifier
        success:
          type: boolean
          description: Whether summarization succeeded
        summary:
          $ref: '#/components/schemas/SummaryResponse'
          description: Summary details (present if success is true)
        error:
          type: string
          description: Error message (present if success is false)

    BatchOperationResponse:
      type: object
      description: Standardized response for all batch operations (emails and tasks)
      properties:
        success:
          type: boolean
          description: Whether the overall operation completed without critical errors
        processed:
          type: integer
          description: Total number of items that were processed
        successful:
          type: integer
          description: Count of items that completed successfully
        failed:
          type: integer
          description: Count of items that failed to process
        results:
          type: array
          description: Detailed results for each processed item (optional)
          items:
            $ref: '#/components/schemas/BatchItemResult'
        errors:
          type: array
          description: Error messages from the operation (optional)
          items:
            type: string
        message:
          type: string
          description: Human-readable summary of the operation (optional)

    BatchItemResult:
      type: object
      description: Result of processing a single item in a batch operation
      properties:
        item_id:
          type: string
          description: Identifier of the item that was processed
        success:
          type: boolean
          description: Whether this specific item was processed successfully
        error:
          type: string
          description: Error message if processing failed (optional)
        data:
          type: object
          description: |
            Operation-specific result data (optional).
            For emails: category, confidence, reasoning, action_items, priority.
            For tasks: updated fields, status changes.
          additionalProperties: true

    Task:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [pending, in_progress, completed, cancelled]
        priority:
          type: string
          enum: [low, medium, high, urgent]
        category:
          type: string
        email_id:
          type: string
        one_line_summary:
          type: string
        due_date:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time

    TaskCreate:
      type: object
      required:
        - title
      properties:
        title:
          type: string
        description:
          type: string
        status:
          type: string
        priority:
          type: string
        category:
          type: string
        email_id:
          type: string
        due_date:
          type: string
          format: date-time

    TaskUpdate:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        status:
          type: string
        priority:
          type: string
        category:
          type: string
        email_id:
          type: string
        due_date:
          type: string
          format: date-time

    TaskListResponse:
      type: object
      properties:
        tasks:
          type: array
          items:
            $ref: '#/components/schemas/Task'
        total_count:
          type: integer
        page:
          type: integer
        page_size:
          type: integer
        has_next:
          type: boolean

    UserSettings:
      type: object
      properties:
        username:
          type: string
        job_context:
          type: string
        newsletter_interests:
          type: string
        azure_openai_endpoint:
          type: string
        azure_openai_deployment:
          type: string
        custom_prompts:
          type: object
        ado_area_path:
          type: string
        ado_pat:
          type: string

    HolisticAnalysisRequest:
      type: object
      required:
        - email_ids
      properties:
        email_ids:
          type: array
          items:
            type: string
          minItems: 1
          description: Array of email IDs to analyze

    TrulyRelevantAction:
      type: object
      properties:
        action_type:
          type: string
          enum: [required_personal_action, team_action, optional_action]
        priority:
          type: string
          enum: [high, medium, low]
        topic:
          type: string
        canonical_email_id:
          type: string
        related_email_ids:
          type: array
          items:
            type: string
        deadline:
          type: string
          description: ISO date or description
        why_relevant:
          type: string
        blocking_others:
          type: boolean

    SupersededAction:
      type: object
      properties:
        original_email_id:
          type: string
        superseded_by_email_id:
          type: string
        reason:
          type: string

    DuplicateGroup:
      type: object
      properties:
        topic:
          type: string
        email_ids:
          type: array
          items:
            type: string
        keep_email_id:
          type: string
        archive_email_ids:
          type: array
          items:
            type: string

    ExpiredItem:
      type: object
      properties:
        email_id:
          type: string
        reason:
          type: string

    HolisticAnalysisResponse:
      type: object
      properties:
        truly_relevant_actions:
          type: array
          items:
            $ref: '#/components/schemas/TrulyRelevantAction'
        superseded_actions:
          type: array
          items:
            $ref: '#/components/schemas/SupersededAction'
        duplicate_groups:
          type: array
          items:
            $ref: '#/components/schemas/DuplicateGroup'
        expired_items:
          type: array
          items:
            $ref: '#/components/schemas/ExpiredItem'
        emails_analyzed:
          type: integer
        processing_time:
          type: number
          format: float
